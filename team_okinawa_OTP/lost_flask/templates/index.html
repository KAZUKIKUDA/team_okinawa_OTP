<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>忘れ物掲示板</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 0; display: flex; justify-content: center; }
        .container { width: 80%; max-width: 800px; background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: #2c3e50; }
        form input, form textarea { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
        form button { padding: 10px 15px; border: none; border-radius: 4px; background: #3498db; color: #fff; cursor: pointer; }
        form button:hover { background: #2980b9; }
        .post-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; background: #fafafa; }
        .post-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .username { font-weight: bold; }
        .timestamp { color: #888; font-size: 0.9em; }
        .comments-section { margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px; }
        .comment-card { background: #fff; border: 1px solid #eee; border-radius: 4px; padding: 8px; margin-bottom: 8px; }
        .logout { float: right; margin-top: -40px; }
        img { max-width: 100%; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>忘れ物掲示板</h1>
        <a href="{{ url_for('logout') }}" class="logout">ログアウト</a>
    </header>

    <!-- 投稿フォーム -->
    <section>
        <h2>投稿する</h2>
        <form action="{{ url_for('post') }}" method="post" enctype="multipart/form-data">
            <input type="text" value="{{ username }}" disabled>
            <input type="text" name="item_type" placeholder="忘れ物の種類" required>
            <input type="text" name="location" placeholder="忘れた場所" required>
            <textarea name="content" placeholder="詳細" required></textarea>
            <input type="file" name="image" accept="image/*">
            <button type="submit">投稿</button>
        </form>
    </section>

    <!-- 投稿一覧 -->
    <section>
        <h2>投稿一覧</h2>
        {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <span class="username">{{ post.username }}</span>
                <span class="timestamp">{{ post.timestamp.strftime("%Y/%m/%d %H:%M") }}</span>
            </div>
            <p><strong>種類:</strong> {{ post.item_type }}</p>
	    <p><strong>場所:</strong> {{ post.location }}</p>
	    <p style="white-space: pre-wrap;">{{ post.content }}</p>
            {% if post.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' + post.image_filename) }}" alt="投稿画像">
            {% endif %}

            <!-- コメント -->
            <div class="comments-section">
                <h3>コメント</h3>
                {% for comment in post.comments %}
                    <div class="comment-card">
                        <span class="username">{{ comment.username }}</span>
                        <span class="timestamp">{{ comment.timestamp.strftime("%Y/%m/%d %H:%M") }}</span>
                        <p style="white-space: pre-wrap;">{{ comment.content }}</p>
                    </div>
                {% else %}
                    <p>まだコメントがありません。</p>
                {% endfor %}

                <form action="{{ url_for('post_comment', post_id=post.id) }}" method="post">
                    <textarea name="content" placeholder="コメントを入力" required></textarea>
                    <button type="submit">コメントする</button>
                </form>
            </div>
        </div>
        {% else %}
            <p>まだ投稿がありません。</p>
        {% endfor %}
    </section>
</div>
</body>
</html>

